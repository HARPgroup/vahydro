MAP
NAME WATERUSE
SIZE 480 320
STATUS ON
#SYMBOLSET "./sym_wateruse.sym"
# for map in dd
EXTENT -80.5183 36.124 -77.8022 37.521
UNITS DD
# for map in utm 83z18
#UNITS METERS
SHAPEPATH "data"
FONTSET "./fonts.txt"
PROJECTION
  "init=epsg:4326"
END
DEBUG ON
CONFIG "MS_ERRORFILE" "/tmp/mapserver.log"

SYMBOL
  NAME 'hatch-simple'
  TYPE HATCH
END

SYMBOL
  NAME 'circle'
  TYPE ELLIPSE
  POINTS 1 1 END
  FILLED TRUE
END

WEB
   MAXSCALE 5000000
   IMAGEPATH "/var/www/html/tmp/"
   IMAGEURL "/tmp/"
  METADATA
    "wfs_title"            "COVA-OSGWSP WFS Testing Service"  ## REQUIRED
    "wfs_onlineresource"   "http://deq2.bse.vt.edu/cgi-bin/mapserv?map=/var/www/html/mapserv/drupal_wsp_data.map&"  ## Recommended
    "wfs_srs"               "EPSG:4326"  ## Recommended
    "wfs_abstract"       "This text describes my WFS service." ## Recommended
    "wfs_enable_request" "*"  # necessary
    "ows_schemas_location" "http://ogc.dmsolutions.ca"  ## Optional
  END
   TEMPLATE webmap.html
   VALIDATION
      'runid'   '[0-9]+$'
      'runid1'   '[0-9]+$'
      'runid2'   '[0-9]+$'
      'pscen'    '[0-9]+$'
      'nid'    '[0-9]+$'
      'div1'     '[0-9\.\-]+$'
      'div2'     '[0-9\.\-]+$'
      'div3'     '[0-9\.\-]+$'
      'div4'     '[0-9\.\-]+$'
      'dataname1'     '[0-9a-zA-Z\-]+$'
      'dataname2'     '[0-9a-zA-Z\-]+$'
      'default_runid' '21'
      'default_runid1' '21'
      'default_runid2' '22'
      'default_pscen' '37'
      'default_nid' '184688'
      'default_div1' '-0.15'
      'default_div2' '-0.05'
      'default_div3' '0.05'
      'default_div4' '0.15'
      'default_dataname1' 'auglowflow'
      'default_dataname2' 'auglowflow'
   END
END

LEGEND 
   IMAGECOLOR 245 245 245
   OUTLINECOLOR 0 0 0
   KEYSIZE 20 6
   STATUS embed
   #TRANSPARENCY 0
   LABEL
     COLOR 0 0 0
     #SHADOWCOLOR 218 218 218
     #SHADOWSIZE 2 2
     TYPE TRUETYPE
     FONT arial
     SIZE 7
     ANTIALIAS TRUE
   END # end of label
   POSITION ur
END

LAYER
   NAME model_element_info
   METADATA
      "wfs_title"    "Model Element Info" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "elementid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	  "wfs_version" "1.0.0"
   END
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=postgres password=314159 dbname=model"
   TYPE POLYGON
   STATUS ON
   DUMP TRUE
   DEBUG OFF
   DATA "poly_geom FROM (select a.poly_geom, a.elementid, a.elemname, a.custom1, a.custom2 from scen_model_element as a where a.custom1 in ('cova_ws_subnodal', 'cova_ws_container') and a.scenarioid = %pscen% ) AS foo USING UNIQUE elementid"
   #FILTER "runid = 22"
   TEMPLATE webmap.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      #SYMBOL 'circle'
      #SIZE 11
      NAME "Watershed Bounds"
      COLOR 245 245 245
      BACKGROUNDCOLOR 0 0 0
      OUTLINECOLOR 0 0 0
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END

LAYER
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=postgres password=314159 dbname=model"
   NAME poli_bounds
   GROUP poli_bounds
   TYPE POLYGON
   STATUS DEFAULT
   DEBUG ON
   DATA "the_geom from va_counties"
   #FILTER " projectid = 3"
   TEMPLATE drought.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      NAME "Political Boundaries"
      #TRANSPARENCY 100      
      SYMBOL 'circle'
      SIZE 2
      COLOR -1 -1 -1
      BACKGROUNDCOLOR 0 0 0
      OUTLINECOLOR 0 0 0
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "proj=latlong"
   END
   METADATA
    "DESCRIPTION"   "Political Boundaries"
    "RESULT_FIELDS" "name county state"
   END
END

LAYER
   NAME wsp_coverage
   METADATA
      "wfs_title"    "Spatial Coverage" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "elementid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	  "wfs_version" "1.0.0"
	   "gml_nid_type" "integer"
   END
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=wsp_ro password=314159 dbname=drupal715"
   TYPE POLYGON
   STATUS DEFAULT
   DUMP TRUE
   #OPACITY 0
   DEBUG OFF
   DATA "the_geom FROM (select b.title, a.the_geom, a.entity_id 
      from cache_geofield_coverage_wkt as a 
      left outer join node as b 
      on (a.entity_id = b.nid)
      where a.entity_id = '%nid%'  ) AS foo USING UNIQUE entity_id"
   #FILTER "runid = 22"
   TEMPLATE webmap.html
   #MINSCALE 1000
   #MAXSCALE 50000
   LABELITEM "title"
   CLASS
      NAME "Watershed Bounds"
      COLOR -1 -1 -1
      #BACKGROUNDCOLOR 0 0 0
      OUTLINECOLOR 0 0 0
      STYLE
         OUTLINECOLOR 0 0 0
         WIDTH 1.5
      END
      LABEL
        COLOR 0 0 0
        TYPE TRUETYPE
        FONT arial
        SIZE 8
        ANTIALIAS TRUE
        POSITION CC
        PARTIALS FALSE
        MINDISTANCE 8000
      END
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END

LAYER
   NAME coverage_model_elements
   METADATA
      "wfs_title"    "Model Element Overview" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "elementid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	  "wfs_version" "1.0.0"
   END
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=wsp_ro password=314159 dbname=drupal715"
   TYPE POLYGON
   STATUS OFF
   DUMP TRUE
   DEBUG ON
   # Query ties a control point to its parent
   DATA "the_geom FROM (
      select geo.entity_id, cbp.the_geom, cbp.riverseg
      from cache_geofield_coverage_wkt as geo
      left outer join cbp53_dd as cbp 
      on (
         geo.the_geom && cbp.the_geom 
         and contains(geo.the_geom, ST_PointOnSurface(cbp.the_geom) ) 
      )
      where geo.entity_id = %nid% 
      order by cbp.riverseg 
   ) AS foo USING UNIQUE entity_id"
   #FILTER "scenarioid = %pscen% and runid = %runid1% and dataname = '%dataname1%' "
   TEMPLATE webmap.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      NAME "Area of Interest"
      #COLOR 245 245 245
      COLOR 162 181 205
      BACKGROUNDCOLOR 0 0 0
      OUTLINECOLOR 0 0 0
      LABEL
        COLOR 0 0 0
        TYPE TRUETYPE
        FONT arial
        SIZE 8
        ANTIALIAS TRUE
        POSITION CC
        PARTIALS FALSE
        MINDISTANCE 8000
      END
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END

LAYER
   NAME coverage_system_info
   METADATA
      "wfs_title"    "Water Supply Plan System Information" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "system_nid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	   "gml_current_mgy_type" "double"
	   "gml_current_max_mgd_type" "double"
	   "gml_proj_use_mgy_type" "double"
	   "gml_proj_year_type" "integer"
	   "gml_sw_num_src_type" "integer"
	   "gml_sw_dc_max_mgd_type" "double"
	   "gml_sw_dc_avg_mgd_type" "double"
	   "gml_sw_perm_max_mgy_type" "double"
	   "gml_sw_bg_mgd_type" "double"
	   "gml_gw_num_src_type" "integer"
	   "gml_gw_dc_max_mgd_type" "double"
	   "gml_gw_dc_avg_mgd_type" "double"
	   "gml_gw_perm_max_mgy_type" "double"
	   "gml_gw_bg_mgd_type" "double"
	   "gml_pw_num_src_type" "integer"
	   "gml_pw_dc_max_mgd_type" "double"
	   "gml_pw_dc_avg_mgd_type" "double"
	   "gml_pw_perm_max_mgy_type" "double"
	   "gml_pw_bg_mgd_type" "double"
   END
   #GROUP vwuds_max
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=wsp_ro password=314159 dbname=drupal715"
   TYPE POINT
   STATUS OFF
   DUMP TRUE
   DEBUG OFF
   DATA "the_geom FROM (select geo.entity_id, sys.* 
      from cache_geofield_coverage_wkt as geo
      left outer join wsp_system_locations as sys
      on (
         geo.the_geom && sys.the_geom 
         and contains(geo.the_geom, sys.the_geom ) 
      )
      where geo.entity_id = %nid% 
      ) AS foo USING UNIQUE system_nid"
   #FILTER "leapyear <> true"
   TEMPLATE drought.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      SYMBOL 'circle'
      SIZE 11
      NAME "precip_nml"
      COLOR 245 245 245
      BACKGROUNDCOLOR 245 245 245
      OUTLINECOLOR 0 0 0
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END

LAYER
   NAME physiographic_prov
   METADATA
      "wfs_title"    "Model Element Overview" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "elementid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	   "wfs_version" "1.0.0"
   END
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=wsp_ro password=314159 dbname=drupal715"
   TYPE POLYGON
   STATUS DEFAULT
   DUMP TRUE
   DEBUG ON
   DATA "the_geom FROM (
      select the_geom, gid, division, province, section, provcode 
      from cova_physprov 
   ) AS foobar USING UNIQUE gid"
   TEMPLATE webmap.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      NAME "PIEDMONT"
      EXPRESSION ('[province]' == 'PIEDMONT')
      COLOR 123 104 238
      #COLOR 162 181 205
      BACKGROUNDCOLOR 0 0 0
      OUTLINECOLOR 0 0 0
      LABEL
        COLOR 0 0 0
        TYPE TRUETYPE
        FONT arial
        SIZE 8
        ANTIALIAS TRUE
        POSITION CC
        PARTIALS FALSE
        MINDISTANCE 8000
      END
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END


LAYER
   NAME coverage_system_scaled
   METADATA
      "wfs_title"    "Water Supply Plan System Information" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "system_nid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	   "gml_current_mgy_type" "double"
	   "gml_current_max_mgd_type" "double"
	   "gml_proj_use_mgy_type" "double"
	   "gml_proj_year_type" "integer"
	   "gml_sw_num_src_type" "integer"
	   "gml_sw_dc_max_mgd_type" "double"
	   "gml_sw_dc_avg_mgd_type" "double"
	   "gml_sw_perm_max_mgy_type" "double"
	   "gml_sw_bg_mgd_type" "double"
	   "gml_gw_num_src_type" "integer"
	   "gml_gw_dc_max_mgd_type" "double"
	   "gml_gw_dc_avg_mgd_type" "double"
	   "gml_gw_perm_max_mgy_type" "double"
	   "gml_gw_bg_mgd_type" "double"
	   "gml_pw_num_src_type" "integer"
	   "gml_pw_dc_max_mgd_type" "double"
	   "gml_pw_dc_avg_mgd_type" "double"
	   "gml_pw_perm_max_mgy_type" "double"
	   "gml_pw_bg_mgd_type" "double"
   END
   #GROUP vwuds_max
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=wsp_ro password=314159 dbname=drupal715"
   TYPE POINT
   STATUS off
   DUMP TRUE
   DEBUG OFF
   DATA "the_geom FROM (select geo.entity_id, sys.*, (4 * ceil(sqrt(0.5 + (sys.current_mgy / 365.0)))) as curr_scale 
            
      from cache_geofield_coverage_wkt as geo
      left outer join wsp_system_locations as sys
      on (
         geo.the_geom && sys.the_geom 
         and contains(geo.the_geom, sys.the_geom ) 
      )
      where geo.entity_id = %nid% 
      ) AS foo USING UNIQUE system_nid"
   #FILTER "leapyear <> true"
   TEMPLATE drought.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      STYLE
         SYMBOL 'circle'
         SIZE [curr_scale]
         COLOR 245 245 245
         BACKGROUNDCOLOR 245 245 245
         OUTLINECOLOR 0 0 0
      END
      NAME "Withdrawals"
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END

LAYER
   NAME wsp_system_info
   METADATA
      "wfs_title"    "Water Supply Plan System Information" ## REQUIRED
      "wfs_srs"           "EPSG:4326" ## REQUIRED
      "gml_featureid" "system_nid" ## REQUIRED
      "gml_include_items" "all"  ## Optional (serves all attributes for layer)
      "wfs_enable_request" "*"
	   "gml_current_mgy_type" "double"
	   "gml_current_max_mgd_type" "double"
	   "gml_proj_use_mgy_type" "double"
	   "gml_proj_year_type" "integer"
	   "gml_sw_num_src_type" "integer"
	   "gml_sw_dc_max_mgd_type" "double"
	   "gml_sw_dc_avg_mgd_type" "double"
	   "gml_sw_perm_max_mgy_type" "double"
	   "gml_sw_bg_mgd_type" "double"
	   "gml_gw_num_src_type" "integer"
	   "gml_gw_dc_max_mgd_type" "double"
	   "gml_gw_dc_avg_mgd_type" "double"
	   "gml_gw_perm_max_mgy_type" "double"
	   "gml_gw_bg_mgd_type" "double"
	   "gml_pw_num_src_type" "integer"
	   "gml_pw_dc_max_mgd_type" "double"
	   "gml_pw_dc_avg_mgd_type" "double"
	   "gml_pw_perm_max_mgy_type" "double"
	   "gml_pw_bg_mgd_type" "double"
   END
   #GROUP vwuds_max
   CONNECTIONTYPE postgis
   CONNECTION "host=192.168.0.13 user=wsp_ro password=314159 dbname=drupal715"
   TYPE POINT
   STATUS OFF
   DUMP TRUE
   DEBUG OFF
   DATA "the_geom FROM (select * from wsp_system_locations ) AS foo USING UNIQUE system_nid"
   #FILTER "leapyear <> true"
   TEMPLATE drought.html
   #MINSCALE 1000
   #MAXSCALE 50000
   CLASS
      SYMBOL 'circle'
      SIZE 11
      NAME "precip_nml"
      COLOR 245 245 245
      BACKGROUNDCOLOR 245 245 245
      OUTLINECOLOR 0 0 0
   END
   TOLERANCE 10
   PROJECTION
   # EPSG SRID = 4326
     "init=epsg:4326"
   END
END

LAYER
  NAME infolayer
  STATUS ON
  TYPE annotation
  TRANSFORM false
  FEATURE
    POINTS
      425 35 #this is the position of the text in image coordinates (pixels)
    END
    TEXT " Comparison of %dataname1% metrics for runs %runid1% and %runid2%    " #this is your displaying text
  END   
  CLASS
    #NAME thislabel
    EXPRESSION ( %dataname1% == 'auglowflow' )
    LABEL #defines the font, colors etc. of the text
      TEXT "      Comparison of August Low-Flow metrics      "
      FONT "arial"
      TYPE TRUETYPE
      SIZE 10
      BUFFER 1
      COLOR 0 0 0
      FORCE TRUE
    END
  END 
  CLASS
    #NAME thislabel
    EXPRESSION ( %dataname1% == '7q10' )
    LABEL #defines the font, colors etc. of the text
      TEXT "      Comparison of 7Q10 metrics      "
      FONT "arial"
      TYPE TRUETYPE
      SIZE 10
      BUFFER 1
      COLOR 0 0 0
      FORCE TRUE
    END
  END 
  CLASS
    LABEL #defines the font, colors etc. of the text
      TEXT "      Comparison of metrics      "
      FONT "arial"
      TYPE TRUETYPE
      SIZE 10
      BUFFER 1
      COLOR 0 0 0
      FORCE TRUE
    END
  END 
END
#map definition end
END
#Use this script to generate a list of Drought Contacts
# 1) WSP Staff need to provide list of affected Drought Regions and/or localities
#LOAD CONFIG FILE
library(sqldf)
library(httr)
library(devtools)
install_github("HARPgroup/hydro-tools")
#Use this script to generate a list of Drought Contacts
# 1) WSP Staff need to provide list of affected Drought Regions and/or localities
#LOAD CONFIG FILE
library(sqldf)
library(httr)
library(devtools)
# install_github("HARPgroup/hydro-tools")
library(hydrotools)
source(paste("/var/www/R/config.local.private", sep = ""))
#Drought Regions and localities dataset
drought_regions <- read.csv(paste0(github_location,"/HARParchive/GIS_layers/Drought_Regions_FIPS_Localities.csv"), stringsAsFactors = F)
View(drought_regions)
#Pull list of all contacts associated with a facility
all_contacts <- read.csv(file = "https://deq1.bse.vt.edu/d.dh/ows-permit-contacts-data-export?dh_link_admin_reg_issuer_target_id%5B0%5D=65668&dh_link_admin_reg_issuer_target_id%5B1%5D=91200&dh_link_admin_reg_issuer_target_id%5B2%5D=77498&email_op=not&email=null.email&fstatus=", stringsAsFactors = F)
View(drought_regions)
drought_area <- sqldf('SELECT *
FROM drought_regions
WHERE Drought_Region IN ("Chowan", "Eastern Shore", "Northern Coastal Plain", "Southeast Virginia", "York James")')
View(drought_area)
drought_contacts <- sqldf('SELECT DISTINCT LOWER(a.Email), a.Facility,  b.*
FROM all_contacts AS a
LEFT OUTER JOIN drought_area AS b
ON a."FIPS.Code" = b.FIPS
WHERE b.FIPS IS NOT NULL')
drought_contacts <- sqldf('SELECT DISTINCT LOWER(a.Email),  b.*
FROM all_contacts AS a
LEFT OUTER JOIN drought_area AS b
ON a."FIPS.Code" = b.FIPS
WHERE b.FIPS IS NOT NULL')
# write.csv(drought_contacts, paste0("U:\OWS\Drought\Drought Event Correspondence_etc\2021",Sys.Date(),".csv"), row.names = F)
write.csv(drought_contacts, paste0("C:\Users\nrf46657\Desktop\DMTF\2023.04.06_DMTF\Comms\2023",Sys.Date(),".csv"), row.names = F)
write.csv(drought_contacts, paste0("C:\Users\nrf46657\Desktop\DMTF\2023.04.06_DMTF\Comms\2023",Sys.Date(),".csv"), row.names = F)
paste0("C:\Users\nrf46657\Desktop\DMTF\2023.04.06_DMTF\Comms\2023",Sys.Date(),".csv")
# write.csv(drought_contacts, paste0("U:\OWS\Drought\Drought Event Correspondence_etc\2021",Sys.Date(),".csv"), row.names = F)
write.csv(drought_contacts, paste0("C:\Users\nrf46657\Desktop\DMTF\2023.04.06_DMTF\Comms\Drought_Watch_Contact_List_4-24-2023.csv"), row.names = F)
class(drought_contacts)
paste0("C:\Users\nrf46657\Desktop\DMTF\2023.04.06_DMTF\Comms\Drought_Watch_Contact_List_4-24-2023.csv")
paste0("C:/Users/nrf46657/Desktop/DMTF/2023.04.06_DMTF/Comms/Drought_Watch_Contact_List_4-24-2023.csv")
# write.csv(drought_contacts, paste0("U:\OWS\Drought\Drought Event Correspondence_etc\2021",Sys.Date(),".csv"), row.names = F)
write.csv(drought_contacts, paste0("C:/Users/nrf46657/Desktop/DMTF/2023.04.06_DMTF/Comms/Drought_Watch_Contact_List_4-24-2023.csv"), row.names = F)
View(drought_contacts)
View(all_contacts)

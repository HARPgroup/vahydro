library('tidyverse') #loads in tidyr, dplyr, ggplot2, etc
library('httr')
library('stringr')
library("kableExtra")
library('stringr')
library('sqldf')
library("hydrotools")
library("RCurl")
options(scipen = 999)
#NOTE: The start and end year need to be updated every year
# syear = 1982
syear = 2020
eyear = 2021
#NOTE: switch between file types to save in common drive folder; html or latex
#file_extension <- ".html"
file_extension <- ".tex"
#Generate REST token for authentication --------------------------------------------
rest_uname = FALSE
rest_pw = FALSE
basepath ='/var/www/R'
source(paste0(basepath,'/auth.private'))
source(paste0(basepath,'/config.R'))
# ds <- RomDataSource$new(site)
# ds$get_token()
ds <- RomDataSource$new("http://deq1.bse.vt.edu/d.dh", rest_uname)
ds$get_token(rest_pw)
#also, line 111, changed to mp_all_power. Not sure what MayQA section doe
# export_path <- "U:/OWS/foundation_datasets/awrr/"
export_path <- "C:/Users/nrf46657/Desktop/DEQ_new/CEDS Migration/"
if (file_extension == ".html") {
options(knitr.table.format = "html") #"html" for viewing in Rstudio Viewer pane
file_ext <- ".html" #view in R or browser
} else {
options(knitr.table.format = "latex") #"latex" when ready to output to Overleaf
file_ext <- ".tex" #for easy upload to Overleaf
}
#Kable Styling
latexoptions <- c("scale_down")
year.range <- (eyear-4):eyear
year.range
#GM correct 'county' / 'city of' naming convention
fips <- read.csv(file = "U:\\OWS\\Report Development\\Annual Water Resources Report\\October 2022 Report\\fips_codes_propernames.csv")
fips
tsdef_url <- paste0(site,"ows-awrr-map-export/wd_mgy?ftype_op=%3D&ftype=&tstime_op=between&tstime%5Bvalue%5D=&tstime%5Bmin%5D=1982-01-01&tstime%5Bmax%5D=",eyear,"-12-31&bundle%5B0%5D=well&bundle%5B1%5D=intake")
multi_yr_data <- ds$auth_read(tsdef_url, content_type = "text/csv", delim = ",")
ds
# ds <- RomDataSource$new(site)
# ds$get_token()
ds <- RomDataSource$new("http://deq1.bse.vt.edu:81/d.dh", rest_uname)
d
ds
ds$get_token(rest_pw)
d
ds
tsdef_url
site
site <- "http://deq1.bse.vt.edu/d.dh"
############### PULL DIRECTLY FROM VAHYDRO ###################################################
#load in MGY from Annual Map Exports view
tsdef_url <- paste0(site,"ows-awrr-map-export/wd_mgy?ftype_op=%3D&ftype=&tstime_op=between&tstime%5Bvalue%5D=&tstime%5Bmin%5D=1982-01-01&tstime%5Bmax%5D=",eyear,"-12-31&bundle%5B0%5D=well&bundle%5B1%5D=intake")
#NOTE: this takes 5-8 minutes (grab a snack; stay hydrated)
multi_yr_data <- ds$auth_read(tsdef_url, content_type = "text/csv", delim = ",")
multi_yr_data
tsdef_url
ds <- RomDataSource$new("http://deq1.bse.vt.edu/d.dh", rest_uname)
ds$get_token(rest_pw)
#NOTE: this takes 5-8 minutes (grab a snack; stay hydrated)
multi_yr_data <- ds$auth_read(tsdef_url, content_type = "text/csv", delim = ",")
multi_yr_data
#exclude dalecarlia
multi_yr_data <- multi_yr_data[-which(multi_yr_data$Facility=='DALECARLIA WTP'),]
multi_yr_data
tsdef_url
site <- "http://deq1.bse.vt.edu/d.dh/"
############### PULL DIRECTLY FROM VAHYDRO ###################################################
#load in MGY from Annual Map Exports view
tsdef_url <- paste0(site,"ows-awrr-map-export/wd_mgy?ftype_op=%3D&ftype=&tstime_op=between&tstime%5Bvalue%5D=&tstime%5Bmin%5D=1982-01-01&tstime%5Bmax%5D=",eyear,"-12-31&bundle%5B0%5D=well&bundle%5B1%5D=intake")
#NOTE: this takes 5-8 minutes (grab a snack; stay hydrated)
multi_yr_data <- ds$auth_read(tsdef_url, content_type = "text/csv", delim = ",")
tsdef_url
class(multi_yr_data)
site
tsdef_url
multi_yr_data <- ds$auth_read(tsdef_url, content_type = "text/csv", delim = ",")
multi_yr_data
